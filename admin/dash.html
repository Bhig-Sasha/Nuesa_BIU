<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUESA BIU Admin Dashboard</title>
    <link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* [Keep all your existing CSS styles - they're good] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --primary-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --info: #3b82f6;
            --info-light: #dbeafe;
            --purple: #8b5cf6;
            --purple-light: #ede9fe;
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-600: #475569;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius-sm: 0.25rem;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }

        body {
            background-color: var(--slate-100);
            color: var(--slate-800);
            min-height: 100vh;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            z-index: 9998;
            transform: translateX(500px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--primary);
        }

        .toast-error {
            border-left: 4px solid var(--danger);
        }

        .toast-warning {
            border-left: 4px solid var(--warning);
        }

        .toast-info {
            border-left: 4px solid var(--info);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--slate-400);
            cursor: pointer;
            padding: 4px;
        }

        /* Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid var(--slate-200);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 40;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--slate-200);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 18px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--slate-800);
        }

        .sidebar-title span {
            color: var(--primary);
        }

        .nav {
            padding: 16px;
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius);
            color: var(--slate-600);
            text-decoration: none;
            margin-bottom: 4px;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: var(--slate-100);
            color: var(--slate-800);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--slate-200);
        }

        .logout-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--danger-light);
            color: var(--danger);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .logout-btn:hover {
            background: var(--danger-light);
            opacity: 0.9;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--slate-200);
            padding: 0 24px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 30;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--slate-600);
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius);
        }

        .mobile-menu-btn:hover {
            background: var(--slate-100);
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            color: var(--slate-600);
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius);
        }

        .notification-btn:hover {
            background: var(--slate-100);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Main Area */
        .main-area {
            padding: 24px;
            min-height: calc(100vh - 70px);
        }

        /* Dashboard */
        .page-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 24px;
            color: var(--slate-800);
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--slate-500);
            margin-bottom: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--slate-200);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 20px;
        }

        .icon-blue { background: var(--info-light); color: var(--info); }
        .icon-green { background: var(--primary-light); color: var(--primary); }
        .icon-purple { background: var(--purple-light); color: var(--purple); }
        .icon-red { background: var(--danger-light); color: var(--danger); }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--slate-800);
        }

        .stat-label {
            color: var(--slate-500);
            font-size: 14px;
            font-weight: 500;
        }

        .stat-change {
            font-size: 12px;
            margin-top: 4px;
        }

        .change-positive {
            color: var(--primary);
        }

        .change-negative {
            color: var(--danger);
        }

        /* Content Cards */
        .content-card {
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--slate-200);
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--slate-800);
        }

        /* Charts */
        .chart-container {
            height: 300px;
            margin-bottom: 24px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 16px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .data-table th {
            background: var(--slate-50);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--slate-700);
            border-bottom: 1px solid var(--slate-200);
            white-space: nowrap;
        }

        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--slate-100);
            vertical-align: middle;
        }

        .data-table tr:hover {
            background: var(--slate-50);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .badge-danger {
            background: var(--danger-light);
            color: var(--danger);
        }

        .badge-warning {
            background: var(--warning-light);
            color: #92400e;
        }

        .badge-info {
            background: var(--info-light);
            color: var(--info);
        }

        .badge-purple {
            background: var(--purple-light);
            color: var(--purple);
        }

        .badge-blue {
            background: var(--info-light);
            color: var(--info);
        }

        .badge-red {
            background: var(--danger-light);
            color: var(--danger);
        }

        .badge-yellow {
            background: var(--warning-light);
            color: #92400e;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--slate-200);
            color: var(--slate-700);
        }

        .btn-secondary:hover {
            background: var(--slate-300);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            color: var(--slate-500);
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: var(--slate-100);
            color: var(--slate-700);
        }

        .icon-btn-primary:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .icon-btn-danger:hover {
            background: var(--danger-light);
            color: var(--danger);
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 16px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: auto;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-lg {
            max-width: 800px;
        }

        .modal-xl {
            max-width: 1000px;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--slate-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--slate-800);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--slate-400);
            padding: 4px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--slate-100);
            color: var(--slate-600);
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--slate-700);
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--slate-300);
            border-radius: var(--radius);
            font-size: 14px;
            color: var(--slate-800);
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 640px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--slate-200);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--slate-500);
        }

        .empty-state-icon {
            font-size: 48px;
            color: var(--slate-300);
            margin-bottom: 16px;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 12px;
            border-radius: var(--radius);
            font-size: 12px;
            z-index: 9997;
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            border: 1px solid var(--slate-200);
            box-shadow: var(--shadow-sm);
        }

        .connection-online {
            color: var(--primary-dark);
        }

        .connection-offline {
            color: var(--danger);
        }

        /* Mobile Overlay */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 35;
            display: none;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Search and Filter */
        .search-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 12px;
            border: 1px solid var(--slate-300);
            border-radius: var(--radius);
            font-size: 14px;
        }

        .filter-select {
            padding: 10px 12px;
            border: 1px solid var(--slate-300);
            border-radius: var(--radius);
            font-size: 14px;
            background: white;
            min-width: 150px;
        }

        /* Bulk Actions */
        .bulk-actions {
            display: none;
            padding: 12px;
            background: var(--slate-50);
            border-radius: var(--radius);
            margin-bottom: 16px;
            align-items: center;
            justify-content: space-between;
        }

        .bulk-actions.active {
            display: flex;
        }

        /* File Upload */
        .file-upload-container {
            border: 2px dashed var(--slate-300);
            border-radius: var(--radius);
            padding: 32px;
            text-align: center;
            background: var(--slate-50);
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 16px;
        }

        .file-upload-container:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .file-upload-container.drag-over {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(1.02);
        }

        .file-upload-icon {
            font-size: 48px;
            color: var(--slate-400);
            margin-bottom: 16px;
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: white;
            border: 1px solid var(--slate-200);
            border-radius: var(--radius);
            margin-top: 12px;
        }

        .file-preview-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .file-preview-size {
            font-size: 12px;
            color: var(--slate-500);
        }

        /* Image Preview */
        .image-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--slate-100);
            border: 2px dashed var(--slate-300);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin: 0 auto 16px;
            position: relative;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Tag Input */
        .tag-input-container {
            border: 1px solid var(--slate-300);
            border-radius: var(--radius);
            padding: 8px;
            min-height: 44px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            cursor: text;
        }

        .tag-input-container:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .tag {
            background: var(--primary-light);
            color: var(--primary-dark);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tag-remove {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 2px;
        }

        .tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 60px;
            background: transparent;
        }

        /* Status Toggle */
        .status-toggle {
            display: inline-flex;
            background: var(--slate-200);
            border-radius: 20px;
            padding: 2px;
        }

        .status-toggle-btn {
            padding: 6px 16px;
            border: none;
            background: transparent;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .status-toggle-btn.active {
            background: white;
            color: var(--primary-dark);
            box-shadow: var(--shadow-sm);
        }

        /* Card Grid */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .card-grid-item {
            background: white;
            border: 1px solid var(--slate-200);
            border-radius: var(--radius);
            padding: 16px;
            transition: all 0.3s;
        }

        .card-grid-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        /* Table Avatar */
        .table-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary);
            margin-right: 8px;
        }

        .table-user {
            display: flex;
            align-items: center;
        }

        /* WYSIWYG Editor */
        .editor-toolbar {
            border: 1px solid var(--slate-300);
            border-bottom: none;
            padding: 8px;
            background: var(--slate-50);
            border-radius: var(--radius) var(--radius) 0 0;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .editor-content {
            border: 1px solid var(--slate-300);
            border-radius: 0 0 var(--radius) var(--radius);
            min-height: 200px;
            padding: 12px;
            outline: none;
        }

        .editor-content:focus {
            border-color: var(--primary);
        }

        /* Statistics Mini Cards */
        .stat-card-mini {
            background: white;
            border: 1px solid var(--slate-200);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .stat-card-mini-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--slate-800);
            margin-bottom: 4px;
        }

        .stat-card-mini-label {
            font-size: 12px;
            color: var(--slate-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .quick-action-card {
            background: white;
            border: 1px solid var(--slate-200);
            border-radius: var(--radius);
            padding: 24px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .quick-action-icon {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Session Expired Modal -->
    <div class="modal" id="sessionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Session Expired</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Your session has expired due to inactivity. Please login again.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="stayLoggedIn">Stay Logged In</button>
                <button class="btn btn-primary" id="redirectToLogin">Go to Login</button>
            </div>
        </div>
    </div>

    <!-- Logout Modal -->
    <div class="modal" id="logoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Logout</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to logout?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelLogout">Cancel</button>
                <button class="btn btn-primary" id="confirmLogout">Logout</button>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 class="modal-title" id="eventModalTitle">Add New Event</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="eventForm">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div class="image-preview" id="eventImagePreview">
                            <i class="fas fa-calendar-alt" style="font-size: 48px; color: var(--slate-400);"></i>
                        </div>
                        <input type="file" id="eventImage" accept="image/*" style="display: none;" onchange="previewEventImage(this)">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('eventImage').click()">
                            <i class="fas fa-upload"></i> Upload Image
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Event Title *</label>
                        <input type="text" class="form-input" id="eventTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <textarea class="form-textarea" id="eventDescription" rows="4" required></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-select" id="eventCategory" required>
                                <option value="">Select Category</option>
                                <option value="Workshop">Workshop</option>
                                <option value="Competition">Competition</option>
                                <option value="Social">Social</option>
                                <option value="Career">Career</option>
                                <option value="Academic">Academic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date *</label>
                            <input type="date" class="form-input" id="eventDate" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Start Time *</label>
                            <input type="time" class="form-input" id="eventStartTime" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Time</label>
                            <input type="time" class="form-input" id="eventEndTime">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Location *</label>
                            <input type="text" class="form-input" id="eventLocation" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Organizer</label>
                            <input type="text" class="form-input" id="eventOrganizer">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Max Participants</label>
                            <input type="number" class="form-input" id="eventMaxParticipants" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Registration Deadline</label>
                            <input type="datetime-local" class="form-input" id="eventRegistrationDeadline">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="eventStatus">
                            <option value="upcoming">Upcoming</option>
                            <option value="ongoing">Ongoing</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEvent">Cancel</button>
                <button class="btn btn-primary" id="saveEvent">Save Event</button>
            </div>
        </div>
    </div>

    <!-- Member Modal -->
    <div class="modal" id="memberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 class="modal-title" id="memberModalTitle">Add New Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div class="image-preview" id="memberImagePreview">
                            <i class="fas fa-user-plus" style="font-size: 48px; color: var(--slate-400);"></i>
                        </div>
                        <input type="file" id="memberPhoto" accept="image/*" style="display: none;" onchange="previewMemberImage(this)">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('memberPhoto').click()">
                            <i class="fas fa-upload"></i> Upload Photo
                        </button>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" class="form-input" id="memberName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position *</label>
                            <select class="form-select" id="memberPosition" required>
                                <option value="">Select Position</option>
                                <option value="President">President</option>
                                <option value="Vice President">Vice President</option>
                                <option value="Secretary">Secretary</option>
                                <option value="Treasurer">Treasurer</option>
                                <option value="PRO">PRO</option>
                                <option value="Welfare Director">Welfare Director</option>
                                <option value="Social Director">Social Director</option>
                                <option value="Academic Director">Academic Director</option>
                                <option value="Technical Director">Technical Director</option>
                                <option value="Committee Head">Committee Head</option>
                                <option value="Member">Member</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Email Address *</label>
                            <input type="email" class="form-input" id="memberEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" id="memberPhone">
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Department *</label>
                            <select class="form-select" id="memberDepartment" required>
                                <option value="">Select Department</option>
                                <option value="Electrical/Electronics">Electrical/Electronics</option>
                                <option value="Mechanical Engineering">Mechanical Engineering</option>
                                <option value="Civil Engineering">Civil Engineering</option>
                                <option value="Computer Engineering">Computer Engineering</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Academic Level</label>
                            <select class="form-select" id="memberLevel">
                                <option value="">Select Level</option>
                                <option value="100">100 Level</option>
                                <option value="200">200 Level</option>
                                <option value="300">300 Level</option>
                                <option value="400">400 Level</option>
                                <option value="500">500 Level</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-textarea" id="memberBio" rows="3" placeholder="Brief biography about the member..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Committee (if applicable)</label>
                        <select class="form-select" id="memberCommittee">
                            <option value="">Not in a committee</option>
                            <option value="Academic Committee">Academic Committee</option>
                            <option value="Technical Committee">Technical Committee</option>
                            <option value="Social Committee">Social Committee</option>
                            <option value="Welfare Committee">Welfare Committee</option>
                            <option value="Sports Committee">Sports Committee</option>
                            <option value="Publicity Committee">Publicity Committee</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Social Links</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <input type="url" class="form-input" id="memberLinkedIn" placeholder="LinkedIn URL">
                            <input type="url" class="form-input" id="memberTwitter" placeholder="Twitter URL">
                            <input type="url" class="form-input" id="memberGitHub" placeholder="GitHub URL">
                            <input type="url" class="form-input" id="memberInstagram" placeholder="Instagram URL">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Display Order</label>
                        <input type="number" class="form-input" id="memberOrder" min="1" value="1">
                        <small style="color: var(--slate-500); font-size: 12px;">Lower numbers appear first</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="memberStatus">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="alumni">Alumni</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMember">Cancel</button>
                <button class="btn btn-primary" id="saveMember">Save Member</button>
            </div>
        </div>
    </div>

    <!-- Article Modal -->
    <div class="modal" id="articleModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 class="modal-title" id="articleModalTitle">Add New Article</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="articleForm">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div class="image-preview" id="articleImagePreview">
                            <i class="far fa-newspaper" style="font-size: 48px; color: var(--slate-400);"></i>
                        </div>
                        <input type="file" id="articleImage" accept="image/*" style="display: none;" onchange="previewArticleImage(this)">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('articleImage').click()">
                            <i class="fas fa-upload"></i> Upload Image
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="articleTitle" required>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-select" id="articleCategory" required>
                                <option value="">Select Category</option>
                                <option value="News">News</option>
                                <option value="Events">Events</option>
                                <option value="Academic">Academic</option>
                                <option value="Technical">Technical</option>
                                <option value="Announcement">Announcement</option>
                                <option value="General">General</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Author</label>
                            <input type="text" class="form-input" id="articleAuthor">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Featured Image URL</label>
                        <input type="url" class="form-input" id="articleFeaturedImage" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Excerpt *</label>
                        <textarea class="form-textarea" id="articleExcerpt" rows="3" required placeholder="Brief summary of the article..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Content *</label>
                        <div class="editor-toolbar" id="articleToolbar">
                            <button type="button" class="icon-btn" onclick="formatText('bold')" title="Bold">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="icon-btn" onclick="formatText('italic')" title="Italic">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="icon-btn" onclick="formatText('underline')" title="Underline">
                                <i class="fas fa-underline"></i>
                            </button>
                            <button type="button" class="icon-btn" onclick="insertLink()" title="Insert Link">
                                <i class="fas fa-link"></i>
                            </button>
                            <button type="button" class="icon-btn" onclick="insertList('unordered')" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="icon-btn" onclick="insertList('ordered')" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                        </div>
                        <div class="editor-content" id="articleContent" contenteditable="true" data-placeholder="Write your article content here..."></div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Tags</label>
                            <div class="tag-input-container" id="articleTagsContainer">
                                <input type="text" class="tag-input" id="articleTagInput" placeholder="Type and press Enter...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <div class="status-toggle">
                                <button type="button" class="status-toggle-btn active" data-status="published">Published</button>
                                <button type="button" class="status-toggle-btn" data-status="draft">Draft</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Publish Date</label>
                        <input type="datetime-local" class="form-input" id="articlePublishDate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelArticle">Cancel</button>
                <button class="btn btn-primary" id="saveArticle">Save Article</button>
            </div>
        </div>
    </div>

    <!-- Resource Modal -->
    <div class="modal" id="resourceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="resourceModalTitle">Add New Resource</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="resourceForm">
                    <div class="file-upload-container" id="resourceUploadContainer" onclick="document.getElementById('resourceFile').click()">
                        <div class="file-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="file-upload-text">Click to upload file</div>
                        <div class="file-upload-subtext">Max file size: 50MB</div>
                        <input type="file" id="resourceFile" style="display: none;" onchange="previewResourceFile(this)">
                    </div>
                    
                    <div id="resourcePreview" style="display: none;">
                        <div class="file-preview">
                            <div class="file-preview-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="file-preview-info">
                                <div class="file-preview-name" id="resourceFileName">File name</div>
                                <div class="file-preview-size" id="resourceFileSize">File size</div>
                            </div>
                            <button type="button" class="icon-btn icon-btn-danger" onclick="clearResourceFile()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Resource Title *</label>
                        <input type="text" class="form-input" id="resourceTitle" required>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-select" id="resourceCategory" required>
                                <option value="">Select Category</option>
                                <option value="Past Questions">Past Questions</option>
                                <option value="Lecture Notes">Lecture Notes</option>
                                <option value="Textbooks">Textbooks</option>
                                <option value="Projects">Projects</option>
                                <option value="Tutorials">Tutorials</option>
                                <option value="Forms">Forms</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <select class="form-select" id="resourceDepartment">
                                <option value="All">All Departments</option>
                                <option value="Computer">Computer Engineering</option>
                                <option value="Electrical">Electrical/Electronics</option>
                                <option value="Mechanical">Mechanical Engineering</option>
                                <option value="Civil">Civil Engineering</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Course Code</label>
                            <input type="text" class="form-input" id="resourceCourseCode" placeholder="e.g., CPE 301">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Academic Year</label>
                            <input type="text" class="form-input" id="resourceYear" placeholder="e.g., 2023/2024">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="resourceDescription" rows="3" placeholder="Brief description of the resource..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Academic Level</label>
                        <select class="form-select" id="resourceLevel">
                            <option value="All">All Levels</option>
                            <option value="100">100 Level</option>
                            <option value="200">200 Level</option>
                            <option value="300">300 Level</option>
                            <option value="400">400 Level</option>
                            <option value="500">500 Level</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelResource">Cancel</button>
                <button class="btn btn-primary" id="saveResource">Upload Resource</button>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal" id="messageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="messageModalTitle">View Message</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message-content">
                    <div class="message-header" style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--slate-200);">
                        <h4 id="messageSubject" style="margin-bottom: 8px;"></h4>
                        <div style="display: flex; gap: 16px; font-size: 14px; color: var(--slate-500);">
                            <span><strong>From:</strong> <span id="messageSender"></span></span>
                            <span><strong>Date:</strong> <span id="messageDate"></span></span>
                        </div>
                    </div>
                    <div id="messageBody" style="line-height: 1.6;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="markAsReadBtn">Mark as Read</button>
                <button class="btn btn-primary" id="replyToMessageBtn">Reply</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">Website Settings</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs" style="display: flex; border-bottom: 1px solid var(--slate-200); margin-bottom: 20px;">
                    <button class="tab-btn active" data-tab="general">General</button>
                    <button class="tab-btn" data-tab="email">Email</button>
                    <button class="tab-btn" data-tab="social">Social Media</button>
                </div>
                
                <div class="tab-content" id="generalTab">
                    <form id="settingsForm">
                        <div class="form-group">
                            <label class="form-label">Website Name</label>
                            <input type="text" class="form-input" id="siteName" value="NUESA BIU">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Email</label>
                            <input type="email" class="form-input" id="contactEmail" value="nuesa@biu.edu.ng">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Phone</label>
                            <input type="tel" class="form-input" id="contactPhone" value="+234 123 456 7890">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Address</label>
                            <textarea class="form-textarea" id="contactAddress" rows="3">Benson Idahosa University, Benin City</textarea>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                <button class="btn btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">
        <i class="fas fa-wifi"></i>
        <span>Checking connection...</span>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">N</div>
                <div class="sidebar-title">
                    NUESA <span>ADMIN</span>
                </div>
            </div>
            <nav class="nav">
                <button class="nav-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" data-page="members">
                    <i class="fas fa-users"></i>
                    <span>Members</span>
                </button>
                <button class="nav-item" data-page="events">
                    <i class="far fa-calendar-alt"></i>
                    <span>Events</span>
                </button>
                <button class="nav-item" data-page="articles">
                    <i class="far fa-newspaper"></i>
                    <span>News/Articles</span>
                </button>
                <button class="nav-item" data-page="resources">
                    <i class="fas fa-download"></i>
                    <span>Resources</span>
                </button>
                <button class="nav-item" data-page="messages">
                    <i class="far fa-comment-alt"></i>
                    <span>Messages</span>
                </button>
                <button class="nav-item" data-page="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </button>
                <button class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <div class="user-quick-info" style="margin-bottom: 12px;">
                    <div class="user-name" id="sidebarUserName">Admin</div>
                    <div class="user-role" id="sidebarUserRole">Administrator</div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <button class="mobile-menu-btn" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="header-actions">
                    <button class="notification-btn" id="notificationBtn">
                        <i class="far fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge">0</span>
                    </button>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <div>
                            <div class="user-name" id="userName">Loading...</div>
                            <div class="user-role" id="userRole">Administrator</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Area -->
            <main class="main-area" id="contentArea">
                <!-- Content loaded dynamically -->
            </main>
        </div>
    </div>

<script>
    // ============================================
    // CONFIGURATION - FIXED
    // ============================================
    const API_BASE_URL = 'https://nuesa-biu-pjp0.onrender.com';
    
    // Get token from cookies or localStorage
    function getAuthToken() {
        // Try to get from cookie first
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'auth_token') {
                return value;
            }
        }
        // Fallback to localStorage
        return localStorage.getItem('adminToken');
    }
    
    let authToken = getAuthToken();
    let currentUser = null;
    let currentMemberId = null;
    let currentArticleId = null;
    let currentResourceId = null;
    let currentEventId = null;
    let currentMessageId = null;
    let inactivityTimeout;
    
    // ==================== UTILITY FUNCTIONS ====================
    function formatDate(dateString) {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '';
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch {
            return dateString;
        }
    }
    
    function formatDateTime(dateString) {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '';
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch {
            return dateString;
        }
    }
    
    function formatFileSize(bytes) {
        if (!bytes || bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function showLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) overlay.classList.add('active');
    }
    
    function hideLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) overlay.classList.remove('active');
    }
    
    function showToast(message, type = 'info', duration = 5000) {
        // Remove existing toasts
        document.querySelectorAll('.toast').forEach(toast => toast.remove());
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        let icon;
        switch(type) {
            case 'success': icon = 'check-circle'; break;
            case 'error': icon = 'exclamation-circle'; break;
            case 'warning': icon = 'exclamation-triangle'; break;
            default: icon = 'info-circle';
        }
        
        toast.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                <i class="fas fa-${icon}" style="font-size: 16px;"></i>
                <span>${message}</span>
            </div>
            <button class="toast-close" style="background: none; border: none; color: var(--slate-400); cursor: pointer; padding: 4px; margin-left: 12px;">&times;</button>
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 10);
        
        const closeBtn = toast.querySelector('.toast-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            });
        }
        
        setTimeout(() => {
            if (toast.parentElement) {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }
        }, duration);
    }
    
    // Redirect to login
    function redirectToLogin() {
        window.location.href = '/admin/adlog.html';
    }
    
    // ==================== SESSION MANAGEMENT ====================
    function resetInactivityTimer() {
        clearTimeout(inactivityTimeout);
        inactivityTimeout = setTimeout(() => {
            showToast('Your session will expire in 1 minute due to inactivity', 'warning');
            
            // Final warning after 1 minute
            setTimeout(() => {
                showToast('Session expired due to inactivity', 'error');
                logout();
            }, 60000);
        }, 29 * 60 * 1000); // 29 minutes (1 minute before 30 minute expiry)
    }
    
    function setupActivityListeners() {
        const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
        events.forEach(event => {
            document.addEventListener(event, resetInactivityTimer);
        });
        resetInactivityTimer();
    }
    
    // ==================== API CLIENT ====================
    async function apiRequest(endpoint, options = {}) {
        const token = getAuthToken();
        
        if (!token) {
            showToast('Not authenticated', 'error');
            setTimeout(redirectToLogin, 1500);
            throw new Error('Not authenticated');
        }
        
        const url = `${API_BASE_URL}${endpoint}`;
        const config = {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`,
                ...options.headers
            },
            credentials: 'include'
        };
        
        try {
            const response = await fetch(url, config);
            
            // Handle 401 Unauthorized
            if (response.status === 401) {
                // Clear auth data
                document.cookie = 'auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                
                showToast('Session expired. Please login again.', 'error');
                setTimeout(redirectToLogin, 1500);
                throw new Error('Unauthorized');
            }
            
            // Handle other errors
            if (!response.ok) {
                let errorMsg = `HTTP ${response.status}`;
                try {
                    const data = await response.json();
                    errorMsg = data.message || data.error || errorMsg;
                } catch (e) {
                    // Ignore JSON parse errors
                }
                throw new Error(errorMsg);
            }
            
            // Try to parse JSON response
            try {
                return await response.json();
            } catch (e) {
                return { status: 'success', message: 'Operation completed' };
            }
        } catch (error) {
            if (error.message === 'Not authenticated' || error.message === 'Unauthorized') {
                throw error;
            }
            if (error.message.includes('Network') || error.message.includes('Failed to fetch')) {
                console.warn('Network error for', endpoint);
                throw new Error('Network error. Please check your connection.');
            }
            throw error;
        }
    }
    
    async function get(endpoint) {
        return apiRequest(endpoint, { method: 'GET' });
    }
    
    async function post(endpoint, data) {
        return apiRequest(endpoint, {
            method: 'POST',
            body: JSON.stringify(data)
        });
    }
    
    async function put(endpoint, data) {
        return apiRequest(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }
    
    async function del(endpoint) {
        return apiRequest(endpoint, { method: 'DELETE' });
    }
    
    async function uploadFile(endpoint, formData) {
        const token = getAuthToken();

        if (!token) {
            showToast('Not authenticated', 'error');
            setTimeout(redirectToLogin, 1500);
            throw new Error('Not authenticated');
        }

        const url = `${API_BASE_URL}${endpoint}`;

        const controller = new AbortController();
        const timeoutMs = 30000; // 30 seconds timeout
        const timeoutId = setTimeout(() => controller.abort(), timeoutMs);

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData,
                signal: controller.signal,
                credentials: 'include'
            });

            // Handle 401 Unauthorized
            if (response.status === 401) {
                document.cookie = 'auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                localStorage.removeItem('adminToken');
                showToast('Session expired. Please login again.', 'error');
                setTimeout(redirectToLogin, 1500);
                throw new Error('Unauthorized');
            }

            if (!response.ok) {
                let errMsg = `Upload failed: ${response.status}`;
                try {
                    const data = await response.json();
                    if (data && data.message) errMsg = data.message;
                } catch (e) {
                    try {
                        const text = await response.text();
                        if (text) errMsg = text;
                    } catch (e2) {
                        // ignore
                    }
                }
                throw new Error(errMsg);
            }

            try {
                return await response.json();
            } catch (e) {
                return { status: 'success', message: 'Upload completed' };
            }
        } catch (error) {
            if (error.name === 'AbortError') {
                throw new Error('Upload timed out. Please try again with a smaller file.');
            }
            throw error;
        } finally {
            clearTimeout(timeoutId);
        }
    }
    
    // ==================== AUTHENTICATION ====================
    async function checkAuth() {
        const token = getAuthToken();
        console.log('Auth check - token exists:', !!token);
        
        if (!token) {
            console.log('No token found, redirecting to login');
            showToast('Please login to continue', 'info');
            setTimeout(redirectToLogin, 1500);
            return false;
        }
        
        try {
            // Use the verify endpoint with proper Authorization header
            const response = await fetch(`${API_BASE_URL}/api/auth/verify`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });
            
            console.log('Auth verify response status:', response.status);
            
            if (response.ok) {
                const data = await response.json();
                console.log('Auth verify data:', data);
                
                if (data.status === 'success' || data.data) {
                    currentUser = data.data || data.user || { fullName: 'Admin', role: 'admin' };
                    updateUserInfo();
                    return true;
                }
            }
            
            // If verification fails
            console.log('Auth verification failed');
            document.cookie = 'auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            localStorage.removeItem('adminToken');
            showToast('Authentication failed. Please login again.', 'error');
            setTimeout(redirectToLogin, 1500);
            return false;
        } catch (error) {
            console.error('Auth check error:', error);
            showToast('Connection error. Please try again.', 'error');
            return false;
        }
    }
    
    function logout() {
        showModal('logoutModal');
    }
    
    function confirmLogout() {
        // Clear auth token cookie
        document.cookie = 'auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        localStorage.removeItem('adminToken');
        localStorage.removeItem('adminUser');
        hideModal('logoutModal');
        showToast('Logged out successfully', 'success');
        setTimeout(redirectToLogin, 1000);
    }
    
    function updateUserInfo() {
        if (!currentUser) return;
        
        const userName = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');
        const sidebarUserName = document.getElementById('sidebarUserName');
        const sidebarUserRole = document.getElementById('sidebarUserRole');
        
        const name = currentUser.fullName || currentUser.full_name || currentUser.email || 'Admin';
        const role = currentUser.role || 'admin';
        const initial = name.charAt(0).toUpperCase();
        
        if (userName) userName.textContent = name;
        if (userRole) userRole.textContent = role.charAt(0).toUpperCase() + role.slice(1);
        if (userAvatar) userAvatar.textContent = initial;
        if (sidebarUserName) sidebarUserName.textContent = name;
        if (sidebarUserRole) sidebarUserRole.textContent = role.charAt(0).toUpperCase() + role.slice(1);
    }
    
    // ==================== MODAL MANAGEMENT ====================
    function showModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }
    
    function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    }
    
    // ==================== DASHBOARD INITIALIZATION ====================
    async function initDashboard() {
        console.log('Initializing dashboard...');
        showLoading();
        
        try {
            console.log('Checking authentication...');
            const isAuthenticated = await checkAuth();
            console.log('Authentication result:', isAuthenticated);
            
            if (!isAuthenticated) {
                console.log('Not authenticated, stopping initialization');
                hideLoading();
                return;
            }
            
            console.log('Setting up sidebar and event listeners...');
            setupSidebar();
            setupEventListeners();
            setupActivityListeners();
            
            console.log('Loading dashboard content...');
            await loadContent('dashboard');
            updateConnectionStatus();
            
            console.log('Dashboard initialized successfully');
        } catch (error) {
            console.error('Dashboard initialization error:', error);
            showToast('Failed to initialize dashboard: ' + error.message, 'error');
            
            // Show error in content area
            document.getElementById('contentArea').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>Failed to Load Dashboard</h3>
                    <p>${error.message || 'Please try refreshing the page.'}</p>
                    <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 16px;">
                        Refresh Page
                    </button>
                </div>
            `;
        } finally {
            hideLoading();
        }
    }
    
    function setupSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');
        
        // Make sure sidebar is visible
        if (sidebar) {
            sidebar.style.display = 'flex';
        }
        
        document.getElementById('mobileMenuToggle')?.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            mobileOverlay.classList.toggle('active');
        });
        
        mobileOverlay?.addEventListener('click', () => {
            sidebar.classList.remove('open');
            mobileOverlay.classList.remove('active');
        });
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const page = item.getAttribute('data-page');
                
                // Update active state
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                
                // Load content
                loadContent(page);
                
                // Close mobile menu
                sidebar.classList.remove('open');
                mobileOverlay?.classList.remove('active');
            });
        });
        
        document.getElementById('logoutBtn')?.addEventListener('click', logout);
    }
    
    function setupEventListeners() {
        // Modal close buttons
        document.querySelectorAll('.modal-close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) hideModal(modal.id);
            });
        });
        
        // Modal overlay click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) hideModal(this.id);
            });
        });
        
        // Logout modal handlers
        document.getElementById('confirmLogout')?.addEventListener('click', confirmLogout);
        document.getElementById('cancelLogout')?.addEventListener('click', () => {
            hideModal('logoutModal');
        });
        
        // Session modal handlers
        document.getElementById('stayLoggedIn')?.addEventListener('click', () => {
            hideModal('sessionModal');
            resetInactivityTimer();
        });
        
        document.getElementById('redirectToLogin')?.addEventListener('click', redirectToLogin);
    }
    
    function updateConnectionStatus() {
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
            statusElement.innerHTML = '<i class="fas fa-wifi"></i> <span>Online</span>';
            statusElement.className = 'connection-status connection-online';
        }
    }
    
    // ==================== CONTENT LOADING ====================
    async function loadContent(page) {
        console.log(`Loading content for page: ${page}`);
        showLoading();
        
        try {
            let html = '';
            
            switch (page) {
                case 'dashboard':
                    html = await loadDashboard();
                    break;
                case 'members':
                    html = await loadMembers();
                    break;
                case 'events':
                    html = await loadEvents();
                    break;
                case 'articles':
                    html = await loadArticles();
                    break;
                case 'resources':
                    html = await loadResources();
                    break;
                case 'messages':
                    html = await loadMessages();
                    break;
                case 'analytics':
                    html = await loadAnalytics();
                    break;
                case 'settings':
                    html = await loadSettings();
                    break;
                default:
                    html = await loadDashboard();
            }
            
            document.getElementById('contentArea').innerHTML = html;
            document.title = `NUESA BIU Admin - ${page.charAt(0).toUpperCase() + page.slice(1)}`;
            
            initializePageEvents(page);
            
        } catch (error) {
            console.error('Error loading content:', error);
            document.getElementById('contentArea').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>Error Loading Content</h3>
                    <p>${error.message || 'Failed to load content. Please try again.'}</p>
                    <button class="btn btn-primary" onclick="loadContent('dashboard')" style="margin-top: 16px;">
                        Return to Dashboard
                    </button>
                </div>
            `;
        } finally {
            hideLoading();
        }
    }
    
    // ==================== DASHBOARD PAGE ====================
    async function loadDashboard() {
        try {
            console.log('Loading dashboard data...');
            
            // Try to fetch members
            let members = [];
            try {
                const membersRes = await get('/api/admin/members');
                members = membersRes.data || [];
                console.log(`Fetched ${members.length} members`);
            } catch (e) {
                console.log('Members fetch failed:', e.message);
            }
            
            // Try to fetch events
            let events = [];
            try {
                const eventsRes = await get('/api/admin/events');
                events = eventsRes.data || [];
                console.log(`Fetched ${events.length} events`);
            } catch (e) {
                console.log('Events fetch failed:', e.message);
            }
            
            // Try to fetch messages
            let messages = [];
            try {
                const messagesRes = await get('/api/admin/messages');
                messages = messagesRes.data || [];
                console.log(`Fetched ${messages.length} messages`);
            } catch (e) {
                console.log('Messages fetch failed:', e.message);
            }
            
            const activeMembers = members.filter(m => m.status === 'active').length;
            const totalMembers = members.length;
            const totalEvents = events.length;
            const unreadMessages = messages.filter(m => !m.is_read).length;
            
            // Update notification badge
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = unreadMessages;
                badge.style.display = unreadMessages > 0 ? 'block' : 'none';
            }
            
            return `
                <div class="page-title">Dashboard Overview</div>
                <p class="page-subtitle">Welcome back, ${currentUser?.fullName || currentUser?.full_name || 'Administrator'}!</p>
                
                <div class="stats-grid">
                    <div class="stat-card" onclick="loadContent('members')" style="cursor: pointer;">
                        <div class="stat-icon icon-green">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value">${totalMembers}</div>
                        <div class="stat-label">Executive Members</div>
                        <div class="stat-change change-positive">
                            ${activeMembers} active
                        </div>
                    </div>
                    
                    <div class="stat-card" onclick="loadContent('events')" style="cursor: pointer;">
                        <div class="stat-icon icon-purple">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-value">${totalEvents}</div>
                        <div class="stat-label">Events</div>
                    </div>
                    
                    <div class="stat-card" onclick="loadContent('messages')" style="cursor: pointer;">
                        <div class="stat-icon icon-blue">
                            <i class="far fa-comment-alt"></i>
                        </div>
                        <div class="stat-value">${unreadMessages}</div>
                        <div class="stat-label">Unread Messages</div>
                    </div>
                    
                    <div class="stat-card" onclick="loadContent('settings')" style="cursor: pointer;">
                        <div class="stat-icon icon-red">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="stat-value">Admin</div>
                        <div class="stat-label">Settings</div>
                    </div>
                </div>
                
                <div class="quick-actions-grid">
                    <div class="quick-action-card" onclick="loadContent('members'); setTimeout(() => document.getElementById('addMemberBtn')?.click(), 100);">
                        <div class="quick-action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Add Member</div>
                        <div style="font-size: 12px; color: var(--slate-500);">Add executive members</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="loadContent('events'); setTimeout(() => document.getElementById('addEventBtn')?.click(), 100);">
                        <div class="quick-action-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Create Event</div>
                        <div style="font-size: 12px; color: var(--slate-500);">Schedule new events</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="loadContent('resources'); setTimeout(() => document.getElementById('addResourceBtn')?.click(), 100);">
                        <div class="quick-action-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Upload Resource</div>
                        <div style="font-size: 12px; color: var(--slate-500);">Add study materials</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="loadContent('messages')">
                        <div class="quick-action-icon">
                            <i class="far fa-comment-alt"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 4px;">Messages</div>
                        <div style="font-size: 12px; color: var(--slate-500);">${unreadMessages} unread</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 32px;">
                    <div class="content-card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Members</h3>
                            <button class="btn btn-primary btn-sm" onclick="loadContent('members')">
                                View All
                            </button>
                        </div>
                        ${members.length > 0 ? members.slice(0, 5).map(member => `
                            <div style="padding: 12px; border-bottom: 1px solid var(--slate-100);">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div class="table-avatar">${member.full_name?.charAt(0) || '?'}</div>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 2px;">${member.full_name || 'N/A'}</div>
                                        <div style="font-size: 12px; color: var(--slate-500);">
                                            ${member.position || ''} ${member.department ? ` ${member.department}` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('') : '<p style="text-align: center; color: var(--slate-500); padding: 24px;">No members found</p>'}
                    </div>
                    
                    <div class="content-card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Stats</h3>
                        </div>
                        <div style="padding: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span>API Status</span>
                                <span class="status-badge badge-success">Connected</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span>Admin Session</span>
                                <span class="status-badge badge-success">Active</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span>Server Time</span>
                                <span>${new Date().toLocaleTimeString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span>Total Members</span>
                                <span>${totalMembers}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Unread Messages</span>
                                <span>${unreadMessages}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        } catch (error) {
            console.error('Dashboard error:', error);
            return `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>Dashboard Unavailable</h3>
                    <p>${error.message || 'Unable to load dashboard data.'}</p>
                    <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 16px;">
                        Refresh Page
                    </button>
                </div>
            `;
        }
    }
    
    // ==================== MEMBERS MANAGEMENT ====================
    async function loadMembers() {
        try {
            const response = await get('/api/admin/members');
            const members = response.data || [];
            
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Executive Members Management</h3>
                        <button class="btn btn-primary" id="addMemberBtn">
                            <i class="fas fa-plus"></i> Add Member
                        </button>
                    </div>
                    
                    <div class="search-filter">
                        <input type="text" class="search-input" id="memberSearch" placeholder="Search members..." onkeyup="filterMembers()">
                        <select class="filter-select" id="memberPositionFilter" onchange="filterMembers()">
                            <option value="">All Positions</option>
                            <option value="President">President</option>
                            <option value="Vice President">Vice President</option>
                            <option value="Secretary">Secretary</option>
                            <option value="Treasurer">Treasurer</option>
                            <option value="PRO">PRO</option>
                        </select>
                    </div>
                    
                    ${members.length > 0 ? `
                        <div class="table-container">
                            <table class="data-table" id="membersTable">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Position</th>
                                        <th>Department</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${members.map(member => `
                                        <tr>
                                            <td>
                                                <div class="table-user">
                                                    <div class="table-avatar">
                                                        ${member.full_name?.charAt(0) || '?'}
                                                    </div>
                                                    <div>
                                                        <div style="font-weight: 600;">${member.full_name || 'N/A'}</div>
                                                        <div style="font-size: 12px; color: var(--slate-500);">${member.email || ''}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>${member.position || 'N/A'}</td>
                                            <td>${member.department || 'N/A'}</td>
                                            <td>
                                                <span class="status-badge ${member.status === 'active' ? 'badge-success' : 'badge-danger'}">
                                                    ${member.status || 'inactive'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="icon-btn icon-btn-primary" onclick="editMember('${member.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="icon-btn icon-btn-danger" onclick="deleteMember('${member.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No Members Found</h3>
                            <p>Add your first executive member.</p>
                        </div>
                    `}
                </div>
            `;
        } catch (error) {
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Executive Members Management</h3>
                        <button class="btn btn-primary" id="addMemberBtn">
                            <i class="fas fa-plus"></i> Add Member
                        </button>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Members</h3>
                        <p>${error.message}</p>
                        <button class="btn btn-primary" onclick="loadContent('members')" style="margin-top: 16px;">
                            Try Again
                        </button>
                    </div>
                </div>
            `;
        }
    }
    
    function filterMembers() {
        const search = document.getElementById('memberSearch')?.value.toLowerCase() || '';
        const position = document.getElementById('memberPositionFilter')?.value || '';
        
        const rows = document.querySelectorAll('#membersTable tbody tr');
        rows.forEach(row => {
            const name = row.cells[0]?.textContent.toLowerCase() || '';
            const pos = row.cells[1]?.textContent || '';
            const dept = row.cells[2]?.textContent.toLowerCase() || '';
            
            const matchesSearch = name.includes(search) || dept.includes(search);
            const matchesPosition = !position || pos === position;
            
            row.style.display = matchesSearch && matchesPosition ? '' : 'none';
        });
    }
    
    async function editMember(memberId) {
        try {
            showLoading();
            const response = await get(`/api/admin/members/${memberId}`);
            const member = response.data;
            
            if (!member) {
                throw new Error('Member not found');
            }
            
            currentMemberId = memberId;
            document.getElementById('memberModalTitle').textContent = 'Edit Member';
            
            // Set form values
            document.getElementById('memberName').value = member.full_name || '';
            document.getElementById('memberPosition').value = member.position || '';
            document.getElementById('memberEmail').value = member.email || '';
            document.getElementById('memberPhone').value = member.phone || '';
            document.getElementById('memberDepartment').value = member.department || '';
            document.getElementById('memberLevel').value = member.level || '';
            document.getElementById('memberBio').value = member.bio || '';
            document.getElementById('memberCommittee').value = member.committee || '';
            document.getElementById('memberOrder').value = member.display_order || 1;
            document.getElementById('memberStatus').value = member.status || 'active';
            
            // Set social links if they exist
            if (member.social_links) {
                const social = typeof member.social_links === 'string' ? 
                    JSON.parse(member.social_links) : member.social_links;
                document.getElementById('memberLinkedIn').value = social.linkedin || '';
                document.getElementById('memberTwitter').value = social.twitter || '';
                document.getElementById('memberGitHub').value = social.github || '';
                document.getElementById('memberInstagram').value = social.instagram || '';
            }
            
            showModal('memberModal');
        } catch (error) {
            showToast('Failed to load member details: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function saveMember() {
        try {
            const memberData = {
                full_name: document.getElementById('memberName').value.trim(),
                position: document.getElementById('memberPosition').value,
                email: document.getElementById('memberEmail').value.trim(),
                phone: document.getElementById('memberPhone').value.trim(),
                department: document.getElementById('memberDepartment').value,
                level: document.getElementById('memberLevel').value,
                bio: document.getElementById('memberBio').value.trim(),
                committee: document.getElementById('memberCommittee').value,
                display_order: parseInt(document.getElementById('memberOrder').value) || 1,
                status: document.getElementById('memberStatus').value,
                social_links: {
                    linkedin: document.getElementById('memberLinkedIn').value.trim(),
                    twitter: document.getElementById('memberTwitter').value.trim(),
                    github: document.getElementById('memberGitHub').value.trim(),
                    instagram: document.getElementById('memberInstagram').value.trim()
                }
            };
            
            // Validation
            if (!memberData.full_name || !memberData.position || !memberData.department) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (memberData.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(memberData.email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            showLoading();
            
            let response;
            if (currentMemberId) {
                response = await put(`/api/admin/members/${currentMemberId}`, memberData);
            } else {
                response = await post('/api/admin/members', memberData);
            }
            
            showToast(`Member ${currentMemberId ? 'updated' : 'created'} successfully`, 'success');
            hideModal('memberModal');
            await loadContent('members');
        } catch (error) {
            showToast('Failed to save member: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function deleteMember(memberId) {
        if (!confirm('Are you sure you want to delete this member?')) return;
        
        try {
            showLoading();
            await del(`/api/admin/members/${memberId}`);
            showToast('Member deleted successfully', 'success');
            await loadContent('members');
        } catch (error) {
            showToast('Failed to delete member: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    // ==================== EVENTS MANAGEMENT ====================
    async function loadEvents() {
        try {
            const response = await get('/api/admin/events');
            const events = response.data || [];
            
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Events Management</h3>
                        <button class="btn btn-primary" id="addEventBtn">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                    
                    ${events.length > 0 ? `
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Location</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${events.map(event => `
                                        <tr>
                                            <td>${event.title || 'N/A'}</td>
                                            <td>${formatDate(event.date)}</td>
                                            <td>${event.category || 'N/A'}</td>
                                            <td>${event.location || 'N/A'}</td>
                                            <td>
                                                <span class="status-badge ${
                                                    event.status === 'upcoming' ? 'badge-success' :
                                                    event.status === 'ongoing' ? 'badge-info' :
                                                    event.status === 'cancelled' ? 'badge-danger' : 'badge-secondary'
                                                }">
                                                    ${event.status || 'upcoming'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="icon-btn icon-btn-primary" onclick="editEvent('${event.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="icon-btn icon-btn-danger" onclick="deleteEvent('${event.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div class="empty-state">
                            <i class="far fa-calendar-alt"></i>
                            <h3>No Events Found</h3>
                            <p>Create your first event to get started.</p>
                        </div>
                    `}
                </div>
            `;
        } catch (error) {
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Events Management</h3>
                        <button class="btn btn-primary" id="addEventBtn">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Events</h3>
                        <p>${error.message}</p>
                    </div>
                </div>
            `;
        }
    }
    
    async function editEvent(eventId) {
        try {
            showLoading();
            const response = await get(`/api/admin/events/${eventId}`);
            const event = response.data;
            
            if (!event) {
                throw new Error('Event not found');
            }
            
            currentEventId = eventId;
            document.getElementById('eventModalTitle').textContent = 'Edit Event';
            
            // Set form values
            document.getElementById('eventTitle').value = event.title || '';
            document.getElementById('eventDescription').value = event.description || '';
            document.getElementById('eventCategory').value = event.category || '';
            document.getElementById('eventDate').value = event.date ? event.date.split('T')[0] : '';
            document.getElementById('eventStartTime').value = event.start_time || '';
            document.getElementById('eventEndTime').value = event.end_time || '';
            document.getElementById('eventLocation').value = event.location || '';
            document.getElementById('eventOrganizer').value = event.organizer || '';
            document.getElementById('eventMaxParticipants').value = event.max_participants || '';
            document.getElementById('eventStatus').value = event.status || 'upcoming';
            
            showModal('eventModal');
        } catch (error) {
            showToast('Failed to load event details: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function saveEvent() {
        try {
            const eventData = {
                title: document.getElementById('eventTitle').value.trim(),
                description: document.getElementById('eventDescription').value.trim(),
                category: document.getElementById('eventCategory').value,
                date: document.getElementById('eventDate').value,
                start_time: document.getElementById('eventStartTime').value,
                end_time: document.getElementById('eventEndTime').value,
                location: document.getElementById('eventLocation').value.trim(),
                organizer: document.getElementById('eventOrganizer').value.trim(),
                max_participants: document.getElementById('eventMaxParticipants').value ? 
                    parseInt(document.getElementById('eventMaxParticipants').value) : null,
                status: document.getElementById('eventStatus').value
            };
            
            // Validation
            if (!eventData.title || !eventData.date) {
                showToast('Title and date are required', 'error');
                return;
            }
            
            showLoading();
            
            let response;
            if (currentEventId) {
                response = await put(`/api/admin/events/${currentEventId}`, eventData);
            } else {
                response = await post('/api/admin/events', eventData);
            }
            
            showToast(`Event ${currentEventId ? 'updated' : 'created'} successfully`, 'success');
            hideModal('eventModal');
            await loadContent('events');
        } catch (error) {
            showToast('Failed to save event: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function deleteEvent(eventId) {
        if (!confirm('Are you sure you want to delete this event?')) return;
        
        try {
            showLoading();
            await del(`/api/admin/events/${eventId}`);
            showToast('Event deleted successfully', 'success');
            await loadContent('events');
        } catch (error) {
            showToast('Failed to delete event: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    // ==================== RESOURCES MANAGEMENT ====================
    async function loadResources() {
        try {
            const response = await get('/api/admin/resources');
            const resources = response.data || [];
            
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Resources Management</h3>
                        <button class="btn btn-primary" id="addResourceBtn">
                            <i class="fas fa-plus"></i> Add Resource
                        </button>
                    </div>
                    
                    ${resources.length > 0 ? `
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Department</th>
                                        <th>Downloads</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${resources.map(resource => `
                                        <tr>
                                            <td>${resource.title || 'N/A'}</td>
                                            <td>${resource.category || 'N/A'}</td>
                                            <td>${resource.department || 'N/A'}</td>
                                            <td>${resource.download_count || 0}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <a href="${resource.file_url}" target="_blank" class="icon-btn icon-btn-primary" title="Download">
                                                        <i class="fas fa-download"></i>
                                                    </a>
                                                    <button class="icon-btn icon-btn-danger" onclick="deleteResource('${resource.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div class="empty-state">
                            <i class="fas fa-download"></i>
                            <h3>No Resources Found</h3>
                            <p>Upload study materials and resources.</p>
                        </div>
                    `}
                </div>
            `;
        } catch (error) {
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Resources Management</h3>
                        <button class="btn btn-primary" id="addResourceBtn">
                            <i class="fas fa-plus"></i> Add Resource
                        </button>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Resources</h3>
                        <p>${error.message}</p>
                    </div>
                </div>
            `;
        }
    }
    
    async function deleteResource(resourceId) {
        if (!confirm('Are you sure you want to delete this resource?')) return;
        
        try {
            showLoading();
            await del(`/api/admin/resources/${resourceId}`);
            showToast('Resource deleted successfully', 'success');
            await loadContent('resources');
        } catch (error) {
            showToast('Failed to delete resource: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    // ==================== MESSAGES MANAGEMENT ====================
    async function loadMessages() {
        try {
            const response = await get('/api/admin/messages');
            const messages = response.data || [];
            
            const unreadCount = messages.filter(m => !m.is_read).length;
            
            // Update notification badge
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
            
            return `
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Contact Messages</h3>
                        ${unreadCount > 0 ? `
                            <button class="btn btn-secondary btn-sm" onclick="markAllAsRead()">
                                <i class="fas fa-check-double"></i> Mark All as Read
                            </button>
                        ` : ''}
                    </div>
                    
                    ${messages.length > 0 ? `
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Subject</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${messages.map(message => `
                                        <tr style="${!message.is_read ? 'font-weight: bold; background: var(--slate-50);' : ''}">
                                            <td>${message.name || 'N/A'}</td>
                                            <td>${message.email || 'N/A'}</td>
                                            <td>${message.subject || 'No Subject'}</td>
                                            <td>${formatDateTime(message.created_at)}</td>
                                            <td>
                                                <span class="status-badge ${message.is_read ? 'badge-secondary' : 'badge-success'}">
                                                    ${message.is_read ? 'Read' : 'New'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="icon-btn icon-btn-primary" onclick="viewMessage('${message.id}')" title="View">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="icon-btn icon-btn-danger" onclick="deleteMessage('${message.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div class="empty-state">
                            <i class="far fa-comment-alt"></i>
                            <h3>No Messages</h3>
                            <p>When users submit the contact form, messages will appear here.</p>
                        </div>
                    `}
                </div>
            `;
        } catch (error) {
            return `
                <div class="content-card">
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Messages</h3>
                        <p>${error.message}</p>
                    </div>
                </div>
            `;
        }
    }
    
    async function viewMessage(messageId) {
        try {
            showLoading();
            const response = await get(`/api/admin/messages/${messageId}`);
            const message = response.data;
            
            if (!message) {
                throw new Error('Message not found');
            }
            
            currentMessageId = messageId;
            document.getElementById('messageSubject').textContent = message.subject || 'No Subject';
            document.getElementById('messageSender').textContent = `${message.name} <${message.email}>`;
            document.getElementById('messageDate').textContent = formatDateTime(message.created_at);
            document.getElementById('messageBody').innerHTML = message.message.replace(/\n/g, '<br>');
            
            // Mark as read if not already
            if (!message.is_read) {
                await put(`/api/admin/messages/${messageId}/read`, {});
                document.getElementById('markAsReadBtn').style.display = 'none';
                // Refresh messages to update badge
                await loadMessages();
            }
            
            showModal('messageModal');
        } catch (error) {
            showToast('Failed to load message: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function deleteMessage(messageId) {
        if (!confirm('Are you sure you want to delete this message?')) return;
        
        try {
            showLoading();
            await del(`/api/admin/messages/${messageId}`);
            showToast('Message deleted successfully', 'success');
            await loadContent('messages');
        } catch (error) {
            showToast('Failed to delete message: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function markAllAsRead() {
        try {
            showLoading();
            await post('/api/admin/messages/mark-all-read', {});
            showToast('All messages marked as read', 'success');
            await loadContent('messages');
        } catch (error) {
            showToast('Failed to mark messages as read: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    function replyToMessage() {
        const email = document.getElementById('messageSender').textContent.split('<')[1]?.replace('>', '') || '';
        const subject = 'Re: ' + (document.getElementById('messageSubject').textContent || '');
        
        window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}`;
    }
    
    // ==================== ARTICLES PAGE ====================
    async function loadArticles() {
        return `
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Articles Management</h3>
                    <button class="btn btn-primary" id="addArticleBtn" onclick="showToast('Articles feature coming soon', 'info')">
                        <i class="fas fa-plus"></i> Add Article
                    </button>
                </div>
                <div class="empty-state">
                    <i class="far fa-newspaper" style="font-size: 48px; color: var(--slate-300); margin-bottom: 16px;"></i>
                    <h3>Articles Coming Soon</h3>
                    <p>This feature is under development.</p>
                </div>
            </div>
        `;
    }
    
    // ==================== ANALYTICS PAGE ====================
    async function loadAnalytics() {
        return `
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Analytics Dashboard</h3>
                </div>
                <div class="empty-state">
                    <i class="fas fa-chart-bar" style="font-size: 48px; color: var(--slate-300); margin-bottom: 16px;"></i>
                    <h3>Analytics Coming Soon</h3>
                    <p>This feature is under development.</p>
                </div>
            </div>
        `;
    }
    
    // ==================== SETTINGS PAGE ====================
    async function loadSettings() {
        return `
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">Website Settings</h3>
                    <button class="btn btn-primary" onclick="showModal('settingsModal')">
                        <i class="fas fa-cog"></i> Edit Settings
                    </button>
                </div>
                
                <div style="margin-top: 24px;">
                    <div style="background: white; padding: 24px; border-radius: var(--radius); border: 1px solid var(--slate-200);">
                        <h4 style="margin-bottom: 16px; color: var(--slate-700);">Current Configuration</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 8px;">Website Name</div>
                                <div style="color: var(--slate-600); padding: 8px 12px; background: var(--slate-50); border-radius: var(--radius);">NUESA BIU</div>
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 8px;">Current Environment</div>
                                <div style="color: var(--slate-600); padding: 8px 12px; background: var(--slate-50); border-radius: var(--radius);">${API_BASE_URL.includes('localhost') ? 'Development' : 'Production'}</div>
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 8px;">API Status</div>
                                <div style="color: var(--slate-600); padding: 8px 12px; background: var(--slate-50); border-radius: var(--radius);">
                                    <span class="status-badge badge-success">Connected</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    async function saveSettings() {
        try {
            const settings = {
                siteName: document.getElementById('siteName')?.value,
                contactEmail: document.getElementById('contactEmail')?.value,
                contactPhone: document.getElementById('contactPhone')?.value,
                contactAddress: document.getElementById('contactAddress')?.value
            };
            
            showLoading();
            await post('/api/settings', settings);
            showToast('Settings saved successfully', 'success');
            hideModal('settingsModal');
        } catch (error) {
            showToast('Failed to save settings: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    // ==================== FILE UPLOAD FUNCTIONS ====================
    function previewMemberImage(input) {
        const preview = document.getElementById('memberImagePreview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    function previewEventImage(input) {
        const preview = document.getElementById('eventImagePreview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    function previewResourceFile(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const preview = document.getElementById('resourcePreview');
            
            // Validate file size (max 50MB)
            if (file.size > 50 * 1024 * 1024) {
                showToast('File size exceeds 50MB limit', 'error');
                input.value = '';
                return;
            }
            
            document.getElementById('resourceFileName').textContent = file.name;
            document.getElementById('resourceFileSize').textContent = formatFileSize(file.size);
            preview.style.display = 'block';
        }
    }
    
    function clearResourceFile() {
        document.getElementById('resourceFile').value = '';
        document.getElementById('resourcePreview').style.display = 'none';
    }
    
    async function uploadResource() {
        const formData = new FormData();
        const fileInput = document.getElementById('resourceFile');
        const title = document.getElementById('resourceTitle').value;
        const category = document.getElementById('resourceCategory').value;
        
        if (!fileInput.files[0]) {
            showToast('Please select a file to upload', 'error');
            return;
        }
        
        if (!title || !category) {
            showToast('Please fill in all required fields', 'error');
            return;
        }
        
        formData.append('file', fileInput.files[0]);
        formData.append('data', JSON.stringify({
            title: title,
            category: category,
            department: document.getElementById('resourceDepartment').value,
            course_code: document.getElementById('resourceCourseCode').value,
            year: document.getElementById('resourceYear').value,
            description: document.getElementById('resourceDescription').value,
            level: document.getElementById('resourceLevel').value
        }));
        
        try {
            showLoading();
            const response = await uploadFile('/api/admin/resources', formData);
            showToast('Resource uploaded successfully', 'success');
            hideModal('resourceModal');
            await loadContent('resources');
        } catch (error) {
            showToast('Failed to upload resource: ' + error.message, 'error');
        } finally {
            hideLoading();
        }
    }
    
    // ==================== INITIALIZE PAGE EVENTS ====================
    function initializePageEvents(page) {
        switch(page) {
            case 'members':
                initializeMembersPage();
                break;
            case 'events':
                initializeEventsPage();
                break;
            case 'resources':
                initializeResourcesPage();
                break;
            case 'messages':
                initializeMessagesPage();
                break;
            case 'settings':
                initializeSettingsPage();
                break;
        }
    }
    
    function initializeMembersPage() {
        const addMemberBtn = document.getElementById('addMemberBtn');
        if (addMemberBtn) {
            addMemberBtn.addEventListener('click', () => {
                currentMemberId = null;
                document.getElementById('memberModalTitle').textContent = 'Add New Member';
                const form = document.getElementById('memberForm');
                if (form) form.reset();
                const preview = document.getElementById('memberImagePreview');
                if (preview) {
                    preview.innerHTML = '<i class="fas fa-user-plus" style="font-size: 48px; color: var(--slate-400);"></i>';
                }
                showModal('memberModal');
            });
        }
        
        const saveMemberBtn = document.getElementById('saveMember');
        if (saveMemberBtn) {
            saveMemberBtn.addEventListener('click', saveMember);
        }
        
        const cancelMemberBtn = document.getElementById('cancelMember');
        if (cancelMemberBtn) {
            cancelMemberBtn.addEventListener('click', () => hideModal('memberModal'));
        }
    }
    
    function initializeEventsPage() {
        const addEventBtn = document.getElementById('addEventBtn');
        if (addEventBtn) {
            addEventBtn.addEventListener('click', () => {
                currentEventId = null;
                document.getElementById('eventModalTitle').textContent = 'Add New Event';
                document.getElementById('eventForm').reset();
                showModal('eventModal');
            });
        }
        
        const saveEventBtn = document.getElementById('saveEvent');
        if (saveEventBtn) {
            saveEventBtn.removeEventListener('click', saveEvent);
            saveEventBtn.addEventListener('click', saveEvent);
        }
        
        const cancelEventBtn = document.getElementById('cancelEvent');
        if (cancelEventBtn) {
            cancelEventBtn.addEventListener('click', () => hideModal('eventModal'));
        }
    }
    
    function initializeResourcesPage() {
        const addResourceBtn = document.getElementById('addResourceBtn');
        if (addResourceBtn) {
            addResourceBtn.addEventListener('click', () => {
                currentResourceId = null;
                document.getElementById('resourceModalTitle').textContent = 'Upload New Resource';
                document.getElementById('resourceForm').reset();
                clearResourceFile();
                showModal('resourceModal');
            });
        }
        
        const saveResourceBtn = document.getElementById('saveResource');
        if (saveResourceBtn) {
            saveResourceBtn.removeEventListener('click', uploadResource);
            saveResourceBtn.addEventListener('click', uploadResource);
        }
        
        const cancelResourceBtn = document.getElementById('cancelResource');
        if (cancelResourceBtn) {
            cancelResourceBtn.addEventListener('click', () => hideModal('resourceModal'));
        }
    }
    
    function initializeMessagesPage() {
        const replyBtn = document.getElementById('replyToMessageBtn');
        if (replyBtn) {
            replyBtn.addEventListener('click', replyToMessage);
        }
        
        const markReadBtn = document.getElementById('markAsReadBtn');
        if (markReadBtn) {
            markReadBtn.addEventListener('click', async () => {
                if (currentMessageId) {
                    try {
                        await put(`/api/admin/messages/${currentMessageId}/read`, {});
                        showToast('Message marked as read', 'success');
                        markReadBtn.style.display = 'none';
                        await loadMessages();
                    } catch (error) {
                        showToast('Failed to mark as read: ' + error.message, 'error');
                    }
                }
            });
        }
    }
    
    function initializeSettingsPage() {
        const saveSettingsBtn = document.getElementById('saveSettings');
        if (saveSettingsBtn) {
            saveSettingsBtn.addEventListener('click', saveSettings);
        }
        
        const cancelSettingsBtn = document.getElementById('cancelSettings');
        if (cancelSettingsBtn) {
            cancelSettingsBtn.addEventListener('click', () => hideModal('settingsModal'));
        }
    }
    
    // ==================== INITIALIZE ON LOAD ====================
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM fully loaded, checking path:', window.location.pathname);
        
        // Check if we're on the admin dashboard page - FIXED PATH
        if (window.location.pathname.includes('/admin/dash.html') || 
            window.location.pathname.includes('/admin/dash') ||
            window.location.pathname.includes('/admin/dashboard')) {
            console.log('On admin dashboard page, initializing...');
            initDashboard();
        } else {
            console.log('Not on admin dashboard page, current path:', window.location.pathname);
        }
    });
    
    // Make functions available globally
    window.loadContent = loadContent;
    window.logout = logout;
    window.editMember = editMember;
    window.deleteMember = deleteMember;
    window.editEvent = editEvent;
    window.deleteEvent = deleteEvent;
    window.deleteResource = deleteResource;
    window.viewMessage = viewMessage;
    window.markAllAsRead = markAllAsRead;
    window.filterMembers = filterMembers;
    window.previewMemberImage = previewMemberImage;
    window.previewEventImage = previewEventImage;
    window.previewResourceFile = previewResourceFile;
    window.clearResourceFile = clearResourceFile;
    window.uploadResource = uploadResource;
    window.showModal = showModal;
    window.hideModal = hideModal;
</script>
</body>
</html>